<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Overlay Ads Fixed</title>
<link href="https://vjs.zencdn.net/7.20.3/video-js.css" rel="stylesheet">
<style>
  body { margin:0; background:#121212; color:#fff; font-family:Arial,sans-serif; }
  #pause-overlay {
    display:none;
    position:fixed;
    inset:0;
    background:rgba(0,0,0,0.85);
    justify-content:center;
    align-items:center;
    z-index:10000;
  }
  #pause-player {
    width:80%;
    height:60%;
    background:#000;
    border-radius:8px;
    overflow:hidden;
  }
  #sticky-ad {
    position:fixed;
    bottom:20px;
    right:20px;
    width:320px;
    height:180px;
    z-index:9999;
    display:none;
    border-radius:8px;
    overflow:hidden;
    background:#000;
  }
</style>
<script src="https://vjs.zencdn.net/7.20.3/video.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/videojs-ima@1.8.0/dist/videojs.ima.min.js"></script>
</head>
<body>

<!-- Pause Ad Overlay -->
<div id="pause-overlay">
  <div id="pause-player"></div>
</div>

<!-- Sticky/Floating Ad -->
<div id="sticky-ad"></div>

<script>
const vastAds = [
  "https://s.magsrv.com/v1/vast.php?idzone=5755632&ex_av=name",
  "https://s.magsrv.com/v1/vast.php?idzone=5757688&ex_av=name",
  "https://s.magsrv.com/v1/vast.php?idzone=5757692&ex_av=name",
  "https://s.magsrv.com/v1/vast.php?idzone=5757698&ex_av=name"
];

// ---------------- Overlay Ads Setup ----------------
function setupOverlayAds(mainPlayer){
  // ---------------- Pause Ads ----------------
  const pauseOverlay = document.getElementById('pause-overlay');
  const pauseSlot = document.getElementById('pause-player');
  let pausePlayer = null;

  mainPlayer.on('pause', function(){
    if(mainPlayer.getState && mainPlayer.getState() === "COMPLETE") return;

    pauseOverlay.style.display = 'flex';
    if(!pausePlayer){
      const videoEl = document.createElement('video');
      videoEl.id = 'pauseInnerVideo';
      videoEl.className = 'video-js vjs-default-skin';
      videoEl.setAttribute('playsinline','');
      videoEl.style.width='100%';
      videoEl.style.height='100%';
      pauseSlot.appendChild(videoEl);

      pausePlayer = videojs(videoEl, { controls:true, autoplay:true, preload:'auto' });
      pausePlayer.ima({ id: videoEl.id, adLabel: 'Advertisement' });

      // Rotate VAST tags
      (async ()=>{
        for(let tag of vastAds){
          try{
            pausePlayer.ima.setAdTag(tag);
            pausePlayer.ima.requestAds();
            pausePlayer.ima.on('adsready', ()=>{ pausePlayer.ima.startAds(); });
            pausePlayer.ima.on('adscompleted', ()=>{ pauseOverlay.style.display='none'; });
            break;
          } catch(e){ continue; }
        }
      })();
    } else { pausePlayer.play(); }
  });

  mainPlayer.on('play', ()=>{ pauseOverlay.style.display='none'; if(pausePlayer) pausePlayer.pause(); });

  // ---------------- Sticky/Floating Ads ----------------
  const stickyDiv = document.getElementById('sticky-ad');
  let stickyPlayer = null;

  mainPlayer.on('time', function(e){
    const currentTime = mainPlayer.getPosition ? mainPlayer.getPosition() : e.position || 0;
    const duration = mainPlayer.getDuration ? mainPlayer.getDuration() : 120; // fallback
    if(currentTime >= duration*0.5 && stickyDiv.style.display==='none'){ // after mid-roll
      stickyDiv.style.display='block';
      if(!stickyPlayer){
        const videoEl = document.createElement('video');
        videoEl.id = 'stickyInnerVideo';
        videoEl.className = 'video-js vjs-default-skin';
        videoEl.setAttribute('playsinline','');
        videoEl.setAttribute('muted','true');
        videoEl.style.width='100%';
        videoEl.style.height='100%';
        stickyDiv.appendChild(videoEl);

        stickyPlayer = videojs(videoEl, { controls:false, autoplay:true, muted:true, preload:'auto' });
        stickyPlayer.ima({ id: videoEl.id, adLabel: 'Sponsored' });

        (async ()=>{
          for(let tag of vastAds){
            try{
              stickyPlayer.ima.setAdTag(tag);
              stickyPlayer.ima.requestAds();
              stickyPlayer.ima.on('adsready', ()=>{ stickyPlayer.ima.startAds(); });
              stickyPlayer.ima.on('adscompleted', ()=>{ stickyPlayer.pause(); });
              break;
            } catch(e){ continue; }
          }
        })();
      } else { stickyPlayer.play(); }
    }
  });

  // ---------------- Seek-roll Ads ----------------
  let lastTime = 0;
  mainPlayer.on('time', function(e){
    const currentTime = mainPlayer.getPosition ? mainPlayer.getPosition() : e.position || 0;
    if(Math.abs(currentTime-lastTime)>5){ // user seeked >5s
      lastTime = currentTime;
      pauseOverlay.style.display='flex';
      if(pausePlayer) pausePlayer.play();
    }
  });
}
</script>

</body>
</html>
