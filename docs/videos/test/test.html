<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Overlay Ads Test</title>
<link href="https://vjs.zencdn.net/7.20.3/video-js.css" rel="stylesheet">
<style>
  body { margin:0; background:#121212; color:#fff; font-family:Arial,sans-serif; }
  #pause-overlay {
    display:none;
    position:fixed;
    inset:0;
    background:rgba(0,0,0,0.8);
    justify-content:center;
    align-items:center;
    z-index:10000;
  }
  #pause-player {
    width:80%;
    height:60%;
    background:#000;
    border-radius:8px;
    overflow:hidden;
  }
  #sticky-ad {
    position:fixed;
    bottom:20px;
    right:20px;
    width:320px;
    height:180px;
    z-index:9999;
    display:none;
    border-radius:8px;
    overflow:hidden;
    background:#000;
  }
</style>
<script src="https://vjs.zencdn.net/7.20.3/video.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/videojs-ima@1.8.0/dist/videojs.ima.min.js"></script>
</head>
<body>

<!-- Pause Ad Overlay -->
<div id="pause-overlay">
  <div id="pause-player"></div>
</div>

<!-- Sticky/Floating Ad -->
<div id="sticky-ad"></div>

<script>
const vastAds = [
  "https://s.magsrv.com/v1/vast.php?idzone=5755632&ex_av=name",
  "https://s.magsrv.com/v1/vast.php?idzone=5757688&ex_av=name",
  "https://s.magsrv.com/v1/vast.php?idzone=5757692&ex_av=name",
  "https://s.magsrv.com/v1/vast.php?idzone=5757698&ex_av=name"
];

// ---------------- Pause Ads ----------------
const pauseOverlay = document.getElementById('pause-overlay');
const pauseSlot = document.getElementById('pause-player');
let pausePlayer = null;

// Assuming 'player' is your JW Player main instance
function setupPauseAds(mainPlayer){
  mainPlayer.on('pause', async ()=>{
    if(mainPlayer.getState()==="COMPLETE") return;

    pauseOverlay.style.display = 'flex';
    if(!pausePlayer){
      const videoEl = document.createElement('video');
      pauseSlot.appendChild(videoEl);
      pausePlayer = videojs(videoEl, { controls:true, autoplay:true, preload:'auto' });
      pausePlayer.ima({ id: videoEl.id, adLabel: 'Advertisement' });

      // Try all 4 VASTs in rotation
      let played=false;
      for(let tag of vastAds){
        try{
          pausePlayer.ima.setAdTag(tag);
          pausePlayer.ima.requestAds();
          pausePlayer.ima.on('adsready', ()=>{ pausePlayer.ima.startAds(); });
          pausePlayer.ima.on('adscompleted', ()=>{ pauseOverlay.style.display='none'; });
          played=true;
          break;
        } catch(e){ continue; }
      }
      if(!played) pauseOverlay.style.display='none';
    } else {
      pausePlayer.play();
    }
  });

  mainPlayer.on('play', ()=>{ pauseOverlay.style.display='none'; if(pausePlayer) pausePlayer.pause(); });
}

// ---------------- Sticky/Floating Ads ----------------
const stickyDiv = document.getElementById('sticky-ad');
let stickyPlayer = null;

function showSticky(){
  stickyDiv.style.display = 'block';
  if(!stickyPlayer){
    const videoEl = document.createElement('video');
    stickyDiv.appendChild(videoEl);
    stickyPlayer = videojs(videoEl, { controls:false, autoplay:true, muted:true, preload:'auto' });
    stickyPlayer.ima({ id: videoEl.id, adLabel: 'Sponsored' });

    // Rotate all 4 VASTs
    for(let tag of vastAds){
      try{
        stickyPlayer.ima.setAdTag(tag);
        stickyPlayer.ima.requestAds();
        stickyPlayer.ima.on('adsready', ()=>{ stickyPlayer.ima.startAds(); });
        stickyPlayer.ima.on('adscompleted', ()=>{ stickyPlayer.pause(); });
        break;
      } catch(e){ continue; }
    }
  } else { stickyPlayer.play(); }
}

// ---------------- Seek-roll Ads ----------------
let lastTime = 0;
function setupSeekAds(mainPlayer){
  mainPlayer.on('time', function(e){
    const diff = Math.abs(e.position - lastTime);
    if(diff>5){ // user seeked >5s
      lastTime = e.position;
      showSeekAd();
    }
  });
}

function showSeekAd(){
  // Reuse pause overlay for simplicity
  pauseOverlay.style.display='flex';
  if(pausePlayer) pausePlayer.play();
}
</script>

</body>
</html>
