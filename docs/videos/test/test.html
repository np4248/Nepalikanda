<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Seek-Roll Test</title>
<link href="https://vjs.zencdn.net/7.20.3/video-js.css" rel="stylesheet" />
<style>
body { margin:0; background:#121212; font-family:Arial,sans-serif; color:#fff; display:flex; justify-content:center; align-items:center; height:100vh; }
.video-container { max-width:900px; width:100%; position:relative; }
#seekOverlay {
  position:absolute;
  top:0; left:0; width:100%; height:100%;
  background:rgba(0,0,0,0.75);
  display:none;
  justify-content:center;
  align-items:center;
  z-index:10000;
}
#seekSlot { width:80%; height:60%; background:#000; border-radius:8px; overflow:hidden; }
.video-js { width:100% !important; height:100% !important; }
</style>
<script src="https://vjs.zencdn.net/7.20.3/video.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/videojs-ima@1.8.0/dist/videojs.ima.min.js"></script>
</head>
<body>

<div class="video-container">
  <video id="mainVideo" class="video-js vjs-default-skin" controls preload="auto">
    <source src="../../videoxx/video3.mp4" type="video/mp4" />
  </video>

  <div id="seekOverlay">
    <div id="seekSlot"></div>
  </div>
</div>

<script>
const vastAds = [
  "https://s.magsrv.com/v1/vast.php?idzone=5755632&ex_av=name",
  "https://s.magsrv.com/v1/vast.php?idzone=5757688&ex_av=name",
  "https://s.magsrv.com/v1/vast.php?idzone=5757692",
  "https://s.magsrv.com/v1/vast.php?idzone=5757698"
];

// Main Video.js player
const player = videojs('mainVideo');

// Track last time for detecting seek
let lastTime = 0;
let seekPlayer = null;
const seekOverlay = document.getElementById('seekOverlay');
const seekSlot = document.getElementById('seekSlot');

// Detect seek
player.on('timeupdate', function(){
  const current = player.currentTime();
  if(Math.abs(current - lastTime) > 5){ // threshold for seek (5 seconds)
    triggerSeekAd();
  }
  lastTime = current;
});

// Function to show seek ad
function triggerSeekAd(){
  if(seekPlayer) return; // already playing seek ad

  player.pause();
  seekOverlay.style.display = 'flex';

  // Create inner player for ad
  const v = document.createElement('video');
  v.id = 'seekInner';
  v.className = 'video-js vjs-default-skin';
  v.setAttribute('playsinline','');
  v.setAttribute('preload','auto');
  seekSlot.appendChild(v);

  seekPlayer = videojs(v, {controls:true, autoplay:true});
  seekPlayer.ima({id:'seekInner', adLabel:'Seek Ad'});

  // Rotate VAST links for backup
  let idx = 0;
  function playNextAd(){
    if(idx >= vastAds.length){
      endSeekAd();
      return;
    }
    try{
      seekPlayer.ima.setAdTag(vastAds[idx]);
      seekPlayer.ima.requestAds();
      idx++;
    }catch(e){
      playNextAd();
    }
  }
  playNextAd();

  // Hide overlay after ad completes
  seekPlayer.on('ads-complete', endSeekAd);
  seekPlayer.on('ended', endSeekAd);
}

function endSeekAd(){
  if(seekPlayer){
    seekOverlay.style.display='none';
    try{ seekPlayer.dispose(); } catch(e){}
    seekSlot.innerHTML='';
    seekPlayer=null;
  }
  player.play();
}
</script>
</body>
</html>
