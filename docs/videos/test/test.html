<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kanda Video + Pause/Seek/Sticky Ads</title>

  <!-- JW Player -->
  <script src="https://cdn.jwplayer.com/libraries/IDzF9Zmk.js"></script>

  <!-- Video.js -->
  <link href="https://vjs.zencdn.net/7.20.3/video-js.css" rel="stylesheet" />
  <script src="https://vjs.zencdn.net/7.20.3/video.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/videojs-ima@1.8.0/dist/videojs.ima.min.js"></script>

  <style>
    body { margin:0; background:#121212; color:#fff; font-family: Arial, sans-serif; }
    #video-container { max-width:900px; margin:30px auto; position:relative; }
    #pauseOverlay {
      position:absolute; inset:0; display:none; align-items:center; justify-content:center;
      background: rgba(0,0,0,0.75); z-index:1200;
    }
    #pauseSlot { width:80%; height:60%; background:#000; border-radius:8px; overflow:hidden; }
    #stickyContainer {
      position:fixed; bottom:12px; right:12px; width:320px; height:180px; background:#000;
      z-index:2000; box-shadow:0 10px 30px rgba(0,0,0,0.6); border-radius:8px; overflow:hidden; display:none;
    }
    #stickyHeader { height:28px; background:rgba(0,0,0,0.5); color:#fff; display:flex; align-items:center;
      justify-content:center; font-size:13px; }
    .small-player .video-js { position:absolute !important; top:28px !important; height: calc(100% - 28px) !important; width:100% !important; left:0 !important; }
  </style>
</head>
<body>

<div id="video-container">
  <div id="my-jw-video"></div>

  <div id="pauseOverlay"><div id="pauseSlot"></div></div>
</div>

<div id="stickyContainer">
  <div id="stickyHeader">Sponsored</div>
  <div id="stickySlot" class="small-player"></div>
</div>

<script>
  // === VAST ads for rotation ===
  const vastAds = [
    "https://s.magsrv.com/v1/vast.php?idzone=5755632&ex_av=name",
    "https://s.magsrv.com/v1/vast.php?idzone=5757688&ex_av=name",
    "https://s.magsrv.com/v1/vast.php?idzone=5757692",
    "https://s.magsrv.com/v1/vast.php?idzone=5757698"
  ];

  function rotateVast(index) {
    return [...vastAds.slice(index), ...vastAds.slice(0,index)];
  }

  // === JW Player setup (pre/mid/post-roll) ===
  const player = jwplayer("my-jw-video").setup({
    file: "../../videoxx/video3.mp4",
    width: "100%",
    aspectratio: "16:9",
    autostart: false,
    advertising: {
      client: "vast",
      schedule: [
        { offset:"pre", tag: vastAds[0], skipoffset:15, backupTag: rotateVast(1) },
        { offset:"2:00", tag: vastAds[1], skipoffset:15, backupTag: rotateVast(2) },
        { offset:"post", tag: vastAds[2], skipoffset:15, backupTag: rotateVast(3) }
      ]
    }
  });

  // === Pause Overlay Ads ===
  const pauseOverlay = document.getElementById('pauseOverlay');
  const pauseSlot = document.getElementById('pauseSlot');
  let pauseInner = null;

  player.on('pause', function(){
    if(player.getState() === 'complete') return;
    pauseOverlay.style.display = 'flex';

    if(!pauseInner){
      const v = document.createElement('video');
      v.id = 'pauseInner';
      v.className = 'video-js vjs-default-skin';
      v.setAttribute('playsinline','');
      pauseSlot.appendChild(v);
      pauseInner = videojs(v, {autoplay:true, controls:true});
      pauseInner.ima({id:'pauseInner', adLabel:'Advertisement'});
    }

    // Try all VASTs
    let idx=3; // pause ad default index
    function playPauseAd(i){
      if(i>=vastAds.length){ pauseOverlay.style.display='none'; return; }
      pauseInner.ima.setAdTag(vastAds[i]);
      pauseInner.ima.requestAds();
      pauseInner.ima.on('adsready', ()=>{ pauseInner.ima.startAds(); });
      pauseInner.ima.on('adscompleted', ()=>{ pauseOverlay.style.display='none'; });
      pauseInner.ima.on('adserror', ()=>{ playPauseAd(i+1); });
    }
    playPauseAd(idx);
  });

  player.on('play', function(){ pauseOverlay.style.display='none'; if(pauseInner) pauseInner.pause(); });

  // === Seek-roll ads ===
  let lastTime = 0;
  player.on('time', function(e){
    const curr = e.position;
    if(Math.abs(curr-lastTime)>5){ // seek detected >5 sec
      lastTime = curr;
      // Use Video.js overlay ad
      if(!pauseInner) return;
      pauseOverlay.style.display='flex';
      pauseInner.ima.setAdTag(vastAds[1]);
      pauseInner.ima.requestAds();
      pauseInner.ima.on('adsready', ()=>{ pauseInner.ima.startAds(); });
      pauseInner.ima.on('adscompleted', ()=>{ pauseOverlay.style.display='none'; });
    }else{ lastTime = curr; }
  });

  // === Sticky Ads ===
  const stickyContainer = document.getElementById('stickyContainer');
  const stickySlot = document.getElementById('stickySlot');
  let stickyInner = null;

  function showSticky(){
    stickyContainer.style.display='block';
    if(!stickyInner){
      const v = document.createElement('video');
      v.id = 'stickyInner';
      v.className = 'video-js vjs-default-skin';
      v.setAttribute('playsinline','');
      stickySlot.appendChild(v);
      stickyInner = videojs(v, {autoplay:true, controls:false, muted:true});
      stickyInner.ima({id:'stickyInner', adLabel:'Sponsored'});
    }

    let idx=0;
    function playStickyAd(i){
      if(i>=vastAds.length) return;
      stickyInner.ima.setAdTag(vastAds[i]);
      stickyInner.ima.requestAds();
      stickyInner.ima.on('adsready', ()=>{ stickyInner.ima.startAds(); });
      stickyInner.ima.on('adscompleted', ()=>{ /* can loop or hide sticky if needed */ });
      stickyInner.ima.on('adserror', ()=>{ playStickyAd(i+1); });
    }
    playStickyAd(idx);
  }

  // Show sticky after mid-roll (JW Player triggers mid-roll events)
  player.on('adComplete', function(e){
    if(e.tag === vastAds[1]) showSticky();
  });

  // Optional: hide sticky when main video in view
  function checkStickyHide(){
    const rect = document.getElementById('video-container').getBoundingClientRect();
    if(rect.top>=0 && rect.bottom<=window.innerHeight){
      stickyContainer.style.display='none';
      if(stickyInner){ try{ stickyInner.pause(); }catch(e){} }
    }
  }
  window.addEventListener('scroll', ()=>{ checkStickyHide(); });

</script>

</body>
</html>
