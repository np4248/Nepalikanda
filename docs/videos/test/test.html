<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kanda Video + Full Ads</title>
<style>
  body { margin:0; background:#121212; color:#fff; font-family:Arial,sans-serif; }
  #video-container { max-width:900px; margin:50px auto; position:relative; }
  #sticky-ad { position:fixed; bottom:20px; right:20px; width:320px; height:180px; z-index:9999; border-radius:8px; overflow:hidden; display:none; }
</style>
<script src="https://cdn.jwplayer.com/libraries/IDzF9Zmk.js"></script>
</head>
<body>

<div id="video-container">
  <div id="my-video"></div>
</div>

<div id="sticky-ad"></div>

<script>
const vastAds = [
  "https://s.magsrv.com/v1/vast.php?idzone=5755632&ex_av=name",
  "https://s.magsrv.com/v1/vast.php?idzone=5757688&ex_av=name",
  "https://s.magsrv.com/v1/vast.php?idzone=5757692&ex_av=name",
  "https://s.magsrv.com/v1/vast.php?idzone=5757698&ex_av=name"
];

function rotateTags(startIndex) {
  const out=[];
  for(let i=0;i<vastAds.length;i++) out.push(vastAds[(startIndex+i)%vastAds.length]);
  return out;
}

// ---------------- Main Player ----------------
const player = jwplayer("my-video").setup({
  file: "../../videoxx/video3.mp4",
  width: "100%",
  aspectratio: "16:9",
  autostart: false,
  advertising:{
    client:"vast",
    schedule:[
      { offset:"pre", tag:vastAds[0], backupTag:rotateTags(1) },
      { offset:"2:00", tag:vastAds[1], backupTag:rotateTags(2) },
      { offset:"post", tag:vastAds[2], backupTag:rotateTags(3) }
    ]
  }
});

// ---------------- Pause Ads Inside Main Video ----------------
let pausedTime = 0;
let pauseAdPlaying = false;

player.on('pause', ()=>{
  if(player.getState()==="COMPLETE" || pauseAdPlaying) return;

  pausedTime = player.getPosition();
  pauseAdPlaying = true;

  // Temporarily load pause ad in main player
  player.load([
    {
      file:"../../videoxx/video3.mp4", // fallback local file if VAST fails
      advertising:{ client:"vast", tag:vastAds[3], backupTag:rotateTags(0) }
    }
  ]);

  player.once('ready', ()=>{
    player.play();
  });
});

// After ad completes, resume main content
player.on('adComplete', ()=>{
  if(!pauseAdPlaying) return;

  // reload main video and resume from pausedTime
  player.load([{ file:"../../videoxx/video3.mp4" }]);
  player.once('ready', ()=>{
    player.seek(pausedTime);
    player.play();
    pauseAdPlaying=false;
  });
});

// ---------------- Sticky Ads ----------------
const stickyDiv = document.getElementById('sticky-ad');
let stickyPlayer = null;
function showSticky(){
  stickyDiv.style.display="block";
  if(!stickyPlayer){
    stickyPlayer = jwplayer(stickyDiv).setup({
      file:"../../videoxx/video3.mp4", // fallback local file
      width:"100%",
      height:"100%",
      autostart:true,
      mute:true,
      advertising:{ client:"vast", tag:vastAds[0], backupTag:rotateTags(1) }
    });
  } else { stickyPlayer.play(); }
}

// Show sticky after mid-roll (50% of video)
let midShown=false;
player.on('time', function(e){
  if(!midShown && e.position >= player.getDuration()/2){
    midShown=true;
    showSticky();
  }
});
</script>

</body>
</html>
