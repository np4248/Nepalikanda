<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Click-Triggered Ads Demo</title>
<link href="https://vjs.zencdn.net/7.20.3/video-js.css" rel="stylesheet" />
<style>
body { margin:0; background:#121212; color:#fff; font-family:Arial,sans-serif; display:flex; justify-content:center; align-items:center; height:100vh; }
.video-container { position:relative; max-width:900px; width:100%; }
#clickAdOverlay { position:absolute; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); display:none; justify-content:center; align-items:center; z-index:10000; }
#adSlot { width:80%; height:60%; background:#000; border-radius:8px; overflow:hidden; }
.video-js { width:100% !important; height:100% !important; }
</style>
<script src="https://vjs.zencdn.net/7.20.3/video.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/videojs-ima@1.8.0/dist/videojs.ima.min.js"></script>
</head>
<body>

<div class="video-container" id="videoContainer">
  <video id="mainVideo" class="video-js vjs-default-skin" controls preload="auto">
    <source src="../../videoxx/video3.mp4" type="video/mp4" />
    Your browser doesnâ€™t support HTML5 video.
  </video>

  <div id="clickAdOverlay"><div id="adSlot"></div></div>
</div>

<script>
const vastAds = [
  "https://s.magsrv.com/v1/vast.php?idzone=5755632&ex_av=name",
  "https://s.magsrv.com/v1/vast.php?idzone=5757688&ex_av=name",
  "https://s.magsrv.com/v1/vast.php?idzone=5757692",
  "https://s.magsrv.com/v1/vast.php?idzone=5757698"
];

const player = videojs('mainVideo');
const overlay = document.getElementById('clickAdOverlay');
const adSlot = document.getElementById('adSlot');

let clickCount = 0;
let adPlayer = null;

document.getElementById('videoContainer').addEventListener('click', () => {
  clickCount++;
  if(clickCount >= 2){
    clickCount = 0; // reset
    triggerClickAd();
  }
});

function triggerClickAd(){
  player.pause();
  overlay.style.display = 'flex';

  // create new ad player
  const v = document.createElement('video');
  v.id = 'adVideo';
  v.className = 'video-js vjs-default-skin';
  v.setAttribute('playsinline','');
  v.setAttribute('preload','auto');
  adSlot.appendChild(v);

  adPlayer = videojs(v, {controls:true, autoplay:true});
  adPlayer.ima({ id:'adVideo', adLabel:'Click Ad' });

  // rotate through vastAds
  let idx = 0;
  function tryTag(){
    if(idx >= vastAds.length){ endAd(); return; }
    try{
      adPlayer.ima.setAdTag(vastAds[idx]);
      adPlayer.ima.requestAds();
    } catch(e){
      idx++;
      tryTag();
    }
  }
  tryTag();

  adPlayer.on('ads-complete', endAd);
  adPlayer.on('adserror', endAd);
  adPlayer.on('ended', endAd);
}

function endAd(){
  if(adPlayer){
    adPlayer.dispose();
    adPlayer = null;
  }
  adSlot.innerHTML = '';
  overlay.style.display = 'none';
  player.play();
}
</script>

</body>
</html>
