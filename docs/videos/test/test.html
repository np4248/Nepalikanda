<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kanda Video - Three Player Ads</title>

<!-- Video.js CSS -->
<link href="https://vjs.zencdn.net/7.20.3/video-js.css" rel="stylesheet" />

<style>
body { margin:0; background:#121212; font-family:Arial,sans-serif; color:#fff; display:flex; justify-content:center; align-items:center; height:100vh; }
.video-container { max-width:900px; width:100%; position:relative; }

#pauseOverlay, #floatingOverlay { position:absolute; display:none; z-index:10000; border-radius:8px; overflow:hidden; }
#pauseOverlay { top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.75); display:flex; justify-content:center; align-items:center; }
#floatingOverlay { bottom:10px; right:10px; width:320px; height:180px; background:#000; box-shadow:0 10px 30px rgba(0,0,0,0.6); }

.video-js { width:100% !important; height:100% !important; }
</style>

<!-- Video.js + IMA + Overlay plugin -->
<script src="https://vjs.zencdn.net/7.20.3/video.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/videojs-ima@1.8.0/dist/videojs.ima.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/videojs-overlay@2.1.0/dist/videojs-overlay.min.js"></script>
</head>

<body>
<div class="video-container">
  <!-- Main Player -->
  <video id="mainVideo" class="video-js vjs-default-skin" controls preload="auto" data-setup='{}'>
    <source src="../../videoxx/video3.mp4" type="video/mp4" />
  </video>

  <!-- Pause Overlay -->
  <div id="pauseOverlay">
    <div id="pauseSlot" style="width:80%; height:60%;"></div>
  </div>

  <!-- Floating Overlay -->
  <div id="floatingOverlay">
    <div id="floatingSlot" style="width:100%; height:100%;"></div>
  </div>
</div>

<script>
const vastAds = [
  "https://s.magsrv.com/v1/vast.php?idzone=5755632&ex_av=name",
  "https://s.magsrv.com/v1/vast.php?idzone=5757688&ex_av=name",
  "https://s.magsrv.com/v1/vast.php?idzone=5757692",
  "https://s.magsrv.com/v1/vast.php?idzone=5757698"
];

// ------------------ MAIN PLAYER ------------------
const mainPlayer = videojs('mainVideo');

// IMA plugin for pre/mid/post-roll
mainPlayer.ima({ id:'mainVideo', adLabel:'Advertisement' });

// Pre-roll
mainPlayer.on('ready', function(){
  mainPlayer.ima.setAdTag(vastAds[0]);
  mainPlayer.ima.requestAds();
});

// Mid-roll at 50%
mainPlayer.on('timeupdate', function(){
  const current = mainPlayer.currentTime();
  const duration = mainPlayer.duration();
  if(!mainPlayer.midFired && duration && current >= duration*0.5){
    mainPlayer.midFired = true;
    mainPlayer.ima.setAdTag(vastAds[1]);
    mainPlayer.ima.requestAds();
  }
});

// Post-roll
mainPlayer.on('ended', function(){
  mainPlayer.ima.setAdTag(vastAds[2]);
  mainPlayer.ima.requestAds();
});

// ------------------ PAUSE PLAYER ------------------
const pauseOverlay = document.getElementById('pauseOverlay');
const pauseSlot = document.getElementById('pauseSlot');
let pausePlayer = null;

mainPlayer.on('pause', function(){
  if(mainPlayer.ended()) return;

  pauseOverlay.style.display = 'flex';
  if(!pausePlayer){
    const v = document.createElement('video');
    v.id = 'pauseInner';
    v.className = 'video-js vjs-default-skin';
    v.setAttribute('playsinline','');
    v.setAttribute('preload','auto');
    pauseSlot.appendChild(v);
    pausePlayer = videojs(v, {controls:true, autoplay:true});
    pausePlayer.ima({ id:'pauseInner', adLabel:'Pause Ad' });
  }

  // Play pause ad with fallback rotation
  let idx=0;
  function playPauseAd(){
    if(idx>=vastAds.length) return;
    pausePlayer.ima.setAdTag(vastAds[idx]);
    pausePlayer.ima.requestAds();
    idx++;
  }
  playPauseAd();
});

mainPlayer.on('play', function(){
  pauseOverlay.style.display = 'none';
  if(pausePlayer) pausePlayer.pause();
});

// ------------------ FLOATING/SEEK PLAYER ------------------
const floatingOverlay = document.getElementById('floatingOverlay');
const floatingSlot = document.getElementById('floatingSlot');
let floatingPlayer = null;

// Show floating at 10s for sticky
mainPlayer.on('timeupdate', function(){
  const current = mainPlayer.currentTime();
  if(current>=10 && !floatingPlayer){
    floatingOverlay.style.display='block';
    const v = document.createElement('video');
    v.id='floatingInner';
    v.className='video-js vjs-default-skin';
    v.setAttribute('playsinline','');
    v.setAttribute('preload','auto');
    floatingSlot.appendChild(v);
    floatingPlayer = videojs(v,{controls:false, autoplay:true, muted:true});
    floatingPlayer.ima({id:'floatingInner', adLabel:'Sticky Ad'});
    floatingPlayer.ima.setAdTag(vastAds[3]);
    floatingPlayer.ima.requestAds();
  }
  // Hide floating at 60s
  if(current>=60 && floatingPlayer){
    floatingOverlay.style.display='none';
    try{ floatingPlayer.pause(); floatingPlayer.dispose(); } catch(e){}
    floatingPlayer=null;
    floatingSlot.innerHTML='';
  }
});
</script>
</body>
</html>
