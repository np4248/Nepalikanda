<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Video Test - Kanda</title>

  <!-- Video.js CSS -->
  <link href="https://vjs.zencdn.net/8.0.0/video-js.css" rel="stylesheet" />

  <style>
    body { margin:0; background:#121212; color:#fff; font-family:Arial, sans-serif; }
    .video-container { max-width: 900px; margin: 40px auto; }
    .video-js { width: 100%; height: auto; }
    .sticky-ad { position: fixed; bottom: 10px; right: 10px; width: 200px; height: 100px; background:#ff3333; color:#fff; text-align:center; line-height:100px; z-index:9999; display:none; }
  </style>

  <!-- Video.js JS -->
  <script src="https://vjs.zencdn.net/8.0.0/video.min.js"></script>
  <!-- IMA plugin -->
  <script src="https://cdn.jsdelivr.net/npm/videojs-ima@1.8.0/dist/videojs.ima.min.js"></script>
</head>
<body>

  <div class="video-container">
    <video
      id="my-video"
      class="video-js vjs-default-skin"
      controls
      preload="auto"
      poster=""
      data-setup='{}'>
      <source src="../../videoxx/video3.mp4" type="video/mp4" />
    </video>
  </div>

  <div class="sticky-ad" id="stickyAd">Sticky Ad</div>

  <script>
    var player = videojs('my-video');

    // IMA plugin setup
    player.ima({
      adTagUrl: 'https://s.magsrv.com/v1/vast.php?idzone=5755632&ex_av=name', // pre-roll priority 1
      adsRenderingSettings: {
        enablePreloading: true,
        uiElements: ['countdown', 'skip']
      },
      locale: 'en'
    });

    // Backup ads array for each roll
    const vastBackup = {
      preRoll: [
        'https://s.magsrv.com/v1/vast.php?idzone=5755632&ex_av=name',
        'https://s.magsrv.com/v1/vast.php?idzone=5757688&ex_av=name',
        'https://s.magsrv.com/v1/vast.php?idzone=5757692',
        'https://s.magsrv.com/v1/vast.php?idzone=5757698'
      ],
      midRoll: [
        'https://s.magsrv.com/v1/vast.php?idzone=5757688&ex_av=name',
        'https://s.magsrv.com/v1/vast.php?idzone=5755632&ex_av=name',
        'https://s.magsrv.com/v1/vast.php?idzone=5757692',
        'https://s.magsrv.com/v1/vast.php?idzone=5757698'
      ],
      postRoll: [
        'https://s.magsrv.com/v1/vast.php?idzone=5757692',
        'https://s.magsrv.com/v1/vast.php?idzone=5755632&ex_av=name',
        'https://s.magsrv.com/v1/vast.php?idzone=5757688&ex_av=name',
        'https://s.magsrv.com/v1/vast.php?idzone=5757698'
      ],
      pauseRoll: [
        'https://s.magsrv.com/v1/vast.php?idzone=5757698',
        'https://s.magsrv.com/v1/vast.php?idzone=5755632&ex_av=name',
        'https://s.magsrv.com/v1/vast.php?idzone=5757688&ex_av=name',
        'https://s.magsrv.com/v1/vast.php?idzone=5757692'
      ]
    };

    // Function to try backup ads if primary fails
    function playBackup(adType, index = 0) {
      if (index >= vastBackup[adType].length) return;
      player.ima.changeAdTag(vastBackup[adType][index]);
      player.ima.requestAds();
      player.ima.onAdError(() => {
        playBackup(adType, index + 1);
      });
    }

    // Mid-roll at 2 mins
    player.on('timeupdate', function() {
      if(player.currentTime() >= 120 && !player.midRollPlayed) {
        player.midRollPlayed = true;
        playBackup('midRoll');
      }
    });

    // Post-roll
    player.on('ended', function() {
      playBackup('postRoll');
    });

    // Pause-roll overlay
    player.on('pause', function() {
      if(!player.pauseRollPlayed) {
        player.pauseRollPlayed = true;
        playBackup('pauseRoll');
      }
    });

    // Sticky ad
    player.on('play', function() {
      var sticky = document.getElementById('stickyAd');
      sticky.style.display = 'block';
      setTimeout(()=>{ sticky.style.display = 'none'; }, 15000);
    });

  </script>

</body>
</html>
